# for bootc/bootupd, remote and stateroot ostreecontainer options
# depends on the referenced ostree container being bootable

# Use the default settings.
%ksappend common/common_no_storage_and_payload.ks

# Validate on the first boot.
%ksappend validation/success_on_first_boot.ks

# Set up RPM ostree container image as installation payload
ostreecontainer --no-signature-verification --remote=test-remote --stateroot=test-stateroot --url=@KSTEST_OSTREECONTAINER_URL@

# Reboot the installed system.
reboot

# On Fedora enforce lvm scheme (overriding btrfs default)
%ksappend storage/ostreecontainer_autopart_encrypted.ks

%ksappend storage/luks_auto_unlock_post.ks

%post
# Checks after boot
cat >> /var/lib/extensions/kickstart-tests/usr/libexec/kickstart-test.sh << 'EOF'

# propagate any errors from %post validations;
# we only check that the system booted, so the following generic
# snippet is left in place just for potential future purposes
if [ -e /root/RESULT ]; then
    cat /root/RESULT
fi

EOF
%end

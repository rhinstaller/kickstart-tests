
%ksappend repos/default.ks
%ksappend common/common_no_payload.ks
%ksappend payload/default_packages.ks

# Reboot the installed system.
reboot

# Validate on the first boot.
%ksappend validation/success_on_first_boot.ks

# Set up the actual test.
%post

# Force restorecon on selected container_file_t contexts.
# https://github.com/rhinstaller/kickstart-tests/issues/1607
@KSINCLUDE@ scripts-lib.sh
platform="$(get_platform @KSTEST_OS_NAME@ @KSTEST_OS_VERSION@)"
if [ "${platform}" == "rhel9" ]; then
  restore_container_file_context /etc/X11/xorg.conf.d/00-keyboard.conf
fi

# Make sure something doesn't fix the labels before we can check them.
systemctl disable selinux-autorelabel.service

# Write the code to run after reboot. It lists files with wrong SELinux contexts.
cat > /usr/libexec/kickstart-test.sh << 'EOF'

restorecon -rvn / -e /dev -e /mnt -e /proc -e /run -e /sys

EOF

%end
